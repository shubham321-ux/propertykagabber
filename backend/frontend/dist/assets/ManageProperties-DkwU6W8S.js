import{r as i,j as e,g as A,D as V,E as F,G as I,H as R}from"./index-Bb44EgIv.js";import U from"./AddProperty-BwAYyQ0k.js";import{M as w}from"./Modal-34m7Elgr.js";import"./AdminActionLoader-Bz-KwbY8.js";function G(){const[o,p]=i.useState([]),[E,h]=i.useState(!0),[C,x]=i.useState(!1),[k,n]=i.useState(!1),[l,P]=i.useState(null),[a,d]=i.useState({title:"",description:"",price:"",location:""}),[u,g]=i.useState([]),[c,f]=i.useState(null),[b,j]=i.useState(!1),m=async()=>{h(!0);try{const t=await A();p(t)}catch(t){console.error("Error loading properties:",t)}finally{h(!1)}};i.useEffect(()=>{m()},[]);const D=async t=>{if(window.confirm("Delete this property?"))try{await V(t),p(s=>s.filter(r=>r._id!==t))}catch(s){console.error("Error deleting property:",s)}},S=t=>{P(t._id),d({title:t.title||"",description:t.description||"",price:t.price||"",location:t.location||""}),g([]),f(null),n(!0)},_=async t=>{if(t.preventDefault(),!l)return;j(!0);const s=new FormData;s.append("title",a.title),s.append("description",a.description),s.append("price",a.price),s.append("location",a.location),u.forEach(r=>s.append("images",r)),c&&s.append("video",c);try{const r=await F(l,s);p(L=>L.map(v=>v._id===l?r:v)),n(!1)}catch(r){console.error("Error updating property:",r)}finally{j(!1)}},N=async(t,s)=>{if(window.confirm("Delete this image?"))try{await I.delete(`/properties/${t}/images/${s}`),m()}catch(r){console.error("Failed to delete image:",r)}},y=async t=>{if(window.confirm("Delete this video?"))try{await R(t),m()}catch(s){console.error("Failed to delete video:",s)}};return E?e.jsx("p",{className:"text-center py-10",children:"Loading properties..."}):e.jsxs("div",{className:"max-w-[1400px] mx-auto p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-primary",children:"Manage Properties"}),e.jsx("button",{onClick:()=>x(!0),className:"bg-primary text-white px-4 py-2 rounded-lg hover:bg-primary-light transition",children:"➕ Add Property"})]}),o.length===0&&e.jsx("p",{className:"text-gray-500",children:"No properties found."}),e.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-6",children:o.map(t=>e.jsxs("div",{className:"bg-white shadow rounded-lg p-4 border hover:shadow-lg transition",children:[e.jsx("h3",{className:"text-lg font-semibold",children:t.title}),e.jsx("p",{className:"text-sm text-gray-600",children:t.location}),e.jsxs("p",{className:"text-primary font-bold mt-1",children:["₹ ",t.price?.toLocaleString()]}),t.images?.length>0&&e.jsx("div",{className:"flex gap-2 flex-wrap mt-3",children:t.images.map((s,r)=>e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:s,alt:"Property",className:"w-24 h-20 object-cover rounded-md border"}),e.jsx("button",{onClick:()=>N(t._id,r),className:"absolute -top-2 -right-2 bg-red-600 text-white text-xs rounded-full px-1",children:"✕"})]},r))}),t.video&&e.jsxs("div",{className:"mt-3",children:[e.jsx("video",{src:t.video,controls:!0,className:"w-full rounded-md"}),e.jsx("button",{onClick:()=>y(t._id),className:"bg-red-600 text-white px-3 py-1 text-sm rounded mt-2",children:"Delete Video"})]}),e.jsx("p",{className:"text-gray-700 mt-3 text-sm",children:t.description}),e.jsxs("div",{className:"flex justify-end gap-3 mt-4",children:[e.jsx("button",{onClick:()=>S(t),className:"bg-yellow-500 text-white px-3 py-1 rounded hover:bg-yellow-600",children:"Edit"}),e.jsx("button",{onClick:()=>D(t._id),className:"bg-red-600 text-white px-3 py-1 rounded hover:bg-red-700",children:"Delete"})]})]},t._id))}),e.jsx(w,{open:C,onClose:()=>x(!1),title:"Add Property",children:e.jsx(U,{onSuccess:()=>{x(!1),m()}})}),e.jsx(w,{open:k,onClose:()=>n(!1),title:"Edit Property",children:e.jsxs("form",{onSubmit:_,className:"space-y-3",children:[e.jsx("label",{className:"block text-sm font-medium",children:"Title"}),e.jsx("input",{type:"text",value:a.title,onChange:t=>d({...a,title:t.target.value}),placeholder:"Title",className:"w-full border rounded px-3 py-2"}),e.jsx("label",{className:"block text-sm font-medium",children:"Description"}),e.jsx("textarea",{value:a.description,onChange:t=>d({...a,description:t.target.value}),placeholder:"Description",className:"w-full border rounded px-3 py-2"}),e.jsx("label",{className:"block text-sm font-medium",children:"Price"}),e.jsx("input",{type:"number",value:a.price,onChange:t=>d({...a,price:t.target.value}),placeholder:"Price",className:"w-full border rounded px-3 py-2"}),e.jsx("label",{className:"block text-sm font-medium",children:"Location"}),e.jsx("input",{type:"text",value:a.location,onChange:t=>d({...a,location:t.target.value}),placeholder:"Location",className:"w-full border rounded px-3 py-2"}),l&&o.find(t=>t._id===l)?.images?.length>0&&e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Existing Images"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:o.find(t=>t._id===l).images.map((t,s)=>e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:t,alt:"Existing",className:"w-24 h-20 object-cover rounded-md border"}),e.jsx("button",{type:"button",onClick:()=>N(l,s),className:"absolute -top-2 -right-2 bg-red-600 text-white text-xs rounded-full px-1",children:"✕"})]},s))})]}),l&&o.find(t=>t._id===l)?.video&&e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Existing Video"}),e.jsxs("div",{className:"relative",children:[e.jsx("video",{src:o.find(t=>t._id===l).video,controls:!0,className:"w-full rounded-md border"}),e.jsx("button",{type:"button",onClick:()=>y(l),className:"absolute top-2 right-2 bg-red-600 text-white text-xs px-2 py-1 rounded",children:"Delete Video"})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Add New Images"}),e.jsx("input",{type:"file",multiple:!0,onChange:t=>g(Array.from(t.target.files)),className:"w-full border rounded px-3 py-2"}),u.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:u.map((t,s)=>e.jsx("img",{src:URL.createObjectURL(t),alt:"Preview",className:"w-24 h-20 object-cover rounded-md border"},s))})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Add New Video"}),e.jsx("input",{type:"file",accept:"video/*",onChange:t=>f(t.target.files[0]),className:"w-full border rounded px-3 py-2"}),c&&e.jsx("div",{className:"mt-2",children:e.jsx("video",{src:URL.createObjectURL(c),controls:!0,className:"w-full rounded-md"})})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[e.jsx("button",{type:"button",onClick:()=>n(!1),className:"px-4 py-2 border rounded",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:b,className:"bg-primary text-white px-4 py-2 rounded",children:b?"Saving...":"Save Changes"})]})]})})]})}export{G as default};
